# CafeStock (é…·å’–å•¡è‚¡ç¥¨åŠ©æ‰‹) - A è‚¡å…¬å‘Šæµè§ˆåŠ©æ‰‹

åŸºäº Electron + React çš„æœ¬åœ°åŒ– A è‚¡å¸‚åœºå…¬å‘Šæµè§ˆå™¨ã€‚é€šè¿‡ç¦»çº¿æ•°æ®åº“è®¾è®¡ï¼Œæä¾›æé€Ÿã€æ— å»¶è¿Ÿçš„å…¬å‘Šé˜…è¯»ä½“éªŒã€‚

> **ğŸ“ æ–‡æ¡£ç»´æŠ¤åŸåˆ™ - åˆ†å½¢ç»“æ„è‡ªæŒ‡ç³»ç»Ÿ**
>
> æœ¬é¡¹ç›®é‡‡ç”¨ä¸‰å±‚åˆ†å½¢æ–‡æ¡£ç»“æ„ï¼Œéµå¾ªã€ŠGEBã€‹çš„è‡ªæŒ‡ä¸é€’å½’åŸåˆ™ï¼š
>
> **æ–‡ä»¶å±‚** â†’ æ¯ä¸ª .ts/.tsx æ–‡ä»¶å¼€å¤´æœ‰ INPUT/OUTPUT/POS ä¸‰è¡Œæ³¨é‡Š  
> **ç›®å½•å±‚** â†’ æ¯ä¸ªä»£ç ç›®å½•æœ‰ README.md è¯´æ˜æ¶æ„ä¸æ–‡ä»¶æ¸…å•  
> **ç³»ç»Ÿå±‚** â†’ æ ¹ç›®å½•æ–‡æ¡£æè¿°æ•´ä½“æ¶æ„ä¸æ¨¡å—å…³ç³»
>
> **æ›´æ–°è§„åˆ™**ï¼š
>
> 1. ä¿®æ”¹æ–‡ä»¶ â†’ æ›´æ–°æ–‡ä»¶å¼€å¤´æ³¨é‡Š + æ‰€åœ¨ç›®å½•çš„ README.md
> 2. æ–‡ä»¶å¤¹ç»“æ„å˜åŒ– â†’ æ›´æ–°è¯¥ç›®å½•çš„ README.md + æ ¹ç›®å½•æ¶æ„æ–‡æ¡£
> 3. æ¶æ„çº§å˜æ›´ â†’ æ›´æ–° README.md + docs/architecture-fractal.md
>
> ğŸ’¡ **å“²å­¦**ï¼šå±€éƒ¨æ¸…æ™° â†’ æ¨¡å—æ¸…æ™° â†’ ç³»ç»Ÿæ¸…æ™°ã€‚æ–‡æ¡£å³åœ°å›¾ï¼Œåœ°å›¾å¿…é¡»ä¸é¢†åœŸåŒæ­¥ã€‚

---

## 1. æ ¸å¿ƒæ¶æ„

æœ¬é¡¹ç›®é‡‡ç”¨ **"ä¸»è¿›ç¨‹åŒæ­¥ (Backend Sync) + æœ¬åœ°æ•°æ®åº“ (Local DB) + æ¸²æŸ“è¿›ç¨‹å±•ç¤º (Frontend Display)"** æ¶æ„ã€‚

-   **ä¸»è¿›ç¨‹ (Main Process)**: è´Ÿè´£æ•°æ®åŒæ­¥ã€SQLite æ•°æ®åº“è¯»å†™ã€ä¸ Tushare API é€šä¿¡ã€‚
-   **æ¸²æŸ“è¿›ç¨‹ (Renderer Process)**: çº¯å±•ç¤ºå±‚ï¼Œä¸ç›´æ¥è¯·æ±‚å¤–éƒ¨ APIï¼Œä»…é€šè¿‡ IPC è¯»å–æœ¬åœ°æ•°æ®ã€‚

## 2. åŠŸèƒ½ç‰¹æ€§

### 2.1 æ™ºèƒ½æ•°æ®åŒæ­¥

-   **å¯åŠ¨è‡ªåŠ¨åŒæ­¥**: åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æµ‹å¹¶åŒæ­¥æœ€æ–°å…¬å‘Šã€‚
-   **å¢é‡æ›´æ–°**: è‡ªåŠ¨è®°å½•ä¸Šæ¬¡æ›´æ–°æ—¶é—´ï¼Œåªæ‹‰å–æœ€æ–°çš„å¢é‡æ•°æ®ã€‚
-   **å†å²å›è¡¥**: é¦–æ¬¡è¿è¡Œæˆ–æ•°æ®ç¼ºå¤±æ—¶ï¼Œè‡ªåŠ¨å›è¡¥æœ€è¿‘ 30 å¤©çš„æ•°æ®ã€‚
-   **æ‰‹åŠ¨åˆ·æ–°**: ç•Œé¢æä¾›åˆ·æ–°æŒ‰é’®ï¼Œè§¦å‘å¼ºåˆ¶åŒæ­¥å’Œåˆ—è¡¨åˆ·æ–°ã€‚

### 2.2 è´¢ç»èµ„è®¯ (NEW)

-   **å¤šæ–°é—»æº**: æ”¯æŒæ–°æµªè´¢ç»ã€åå°”è¡—è§é—»ã€åŒèŠ±é¡ºã€ä¸œæ–¹è´¢å¯Œã€äº‘è´¢ç»ç­‰ä¸»æµè´¢ç»ç½‘ç«™ã€‚
-   **å®æ—¶è·å–**: ç›´æ¥ä» Tushare API è·å–æœ€æ–°èµ„è®¯ï¼Œæ— éœ€æœ¬åœ°å­˜å‚¨ã€‚
-   **æ—¶é—´ç­›é€‰**: æ”¯æŒä»Šå¤©ã€æ˜¨å¤©ã€æœ€è¿‘ä¸€å‘¨ã€æœ€è¿‘ä¸€ä¸ªæœˆåŠè‡ªå®šä¹‰æ—¥æœŸèŒƒå›´ã€‚
-   **åˆ†é¡µæµè§ˆ**: æ¯é¡µæ˜¾ç¤º 20 æ¡èµ„è®¯ï¼Œæ”¯æŒç¿»é¡µæŸ¥çœ‹ã€‚
-   **å†…å®¹å±•å¼€**: èµ„è®¯å†…å®¹æ”¯æŒå±•å¼€æŸ¥çœ‹å®Œæ•´ä¿¡æ¯ã€‚

### 2.3 æœ¬åœ°åŒ–å­˜å‚¨

-   ä½¿ç”¨ **SQLite** (`better-sqlite3`) å­˜å‚¨æ‰€æœ‰å…¬å‘Šæ•°æ®ã€‚
-   æ”¯æŒå•æ¬¡ 2000 æ¡çš„å¤§æ‰¹é‡æ•°æ®å†™å…¥ã€‚
-   æ•°æ®å»é‡ç­–ç•¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

### 2.4 æé€Ÿæµè§ˆ

-   **é›¶å»¶è¿Ÿç¿»é¡µ**: åŸºäºæœ¬åœ°æ•°æ®åº“åˆ†é¡µæŸ¥è¯¢ï¼Œç¿»é¡µæ— ç½‘ç»œç­‰å¾…ã€‚
-   **å•é¡µ 200 æ¡**: é«˜å¯†åº¦ä¿¡æ¯å±•ç¤ºï¼Œé€‚åˆå¿«é€Ÿæµè§ˆã€‚

### 2.5 è‡ªåŠ¨æ›´æ–°

-   **è‡ªåŠ¨æ£€æµ‹**: åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥æ–°ç‰ˆæœ¬ã€‚
-   **æ‰‹åŠ¨æ£€æŸ¥**: æ”¯æŒç”¨æˆ·ä¸»åŠ¨æ£€æŸ¥æ›´æ–°ã€‚
-   **åå°ä¸‹è½½**: æ–°ç‰ˆæœ¬åœ¨åå°ä¸‹è½½ï¼Œä¸å½±å“ä½¿ç”¨ã€‚
-   **ä¸€é”®å®‰è£…**: ä¸‹è½½å®Œæˆåï¼Œä¸€é”®é‡å¯å®‰è£…æ–°ç‰ˆæœ¬ã€‚

## 3. æŠ€æœ¯æ ˆ

-   **Runtime**: Electron
-   **Frontend**: React, TypeScript, TailwindCSS
-   **Build Tool**: Vite
-   **Database**: SQLite (better-sqlite3)
-   **API Provider**: Tushare Pro (ä¸Šå¸‚å…¬å¸å…¬å‘Šæ¥å£ `anns_d`)
-   **Auto Update**: electron-updater

## 4. å¼€å‘æŒ‡å—

### 4.1 ç¯å¢ƒå‡†å¤‡

é¦–æ¬¡å¼€å‘å‰ï¼Œå¿…é¡»é‡æ–°ç¼–è¯‘åŸç”Ÿæ¨¡å—ä»¥åŒ¹é… Electron çš„ Node ç‰ˆæœ¬ï¼š

```bash
npm install
npx electron-builder install-app-deps
```

### 4.2 å¯åŠ¨é¡¹ç›®

**å¿…é¡»** ä½¿ç”¨ `npm run dev` å¯åŠ¨ï¼Œå®ƒä¼šæ­£ç¡®å¤„ç† Vite æ„å»ºå’Œ Electron å¯åŠ¨æµç¨‹ã€‚

```bash
npm run dev
```

_æ³¨æ„ï¼šè¯·å‹¿ç›´æ¥è¿è¡Œ `electron .` æˆ–å…¶ä»–å‘½ä»¤ï¼Œä¼šå¯¼è‡´ preload è„šæœ¬åŠ è½½å¤±è´¥ã€‚_

### 4.3 é¡¹ç›®ç»“æ„

-   `electron/`: ä¸»è¿›ç¨‹ä»£ç 
    -   `main.ts`: åº”ç”¨å…¥å£ï¼ŒåŒ…å«åŒæ­¥é€»è¾‘å’Œ IPC ç›‘å¬ã€‚
    -   `db.ts`: æ•°æ®åº“æ“ä½œå°è£…ã€‚
    -   `tushare.ts`: Tushare API å®¢æˆ·ç«¯ã€‚
    -   `preload.ts`: IPC æ¡¥æ¥ (CommonJS)ã€‚
-   `src/`: æ¸²æŸ“è¿›ç¨‹ä»£ç  (React)ã€‚

### 4.4 åˆ†å½¢æ–‡æ¡£å¯¼èˆª

æœ¬é¡¹ç›®å·²ä¸ºæ ¸å¿ƒæ¨¡å—å»ºç«‹åˆ†å½¢æ–‡æ¡£ç»“æ„ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰å®Œæ•´çš„è‡ªè¯´æ˜æ–‡æ¡£ï¼š

#### Electron ä¸»è¿›ç¨‹æ¨¡å—

-   [`electron/services/`](electron/services/README.md) - ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚ âœ… å·²å®æ–½åˆ†å½¢ç»“æ„
-   [`electron/repositories/`](electron/repositories/README.md) - æ•°æ®è®¿é—®å±‚ âœ… å·²å®æ–½åˆ†å½¢ç»“æ„
-   [`electron/ipc/`](electron/ipc/README.md) - IPC é€šä¿¡å±‚ âœ… å·²å®æ–½åˆ†å½¢ç»“æ„

#### React æ¸²æŸ“è¿›ç¨‹æ¨¡å—

-   [`src/components/`](src/components/README.md) - UI ç»„ä»¶å±‚ âœ… å·²å®æ–½åˆ†å½¢ç»“æ„
-   [`src/hooks/`](src/hooks/README.md) - ä¸šåŠ¡é€»è¾‘ Hook å±‚ âœ… å·²å®æ–½åˆ†å½¢ç»“æ„
-   [`src/pages/`](src/pages/README.md) - é¡µé¢å±‚ âœ… å·²å®æ–½åˆ†å½¢ç»“æ„
-   [`src/services/`](src/services/README.md) - IPCé€šä¿¡å°è£…å±‚ âœ… å·²å®æ–½åˆ†å½¢ç»“æ„
-   [`src/types/`](src/types/README.md) - ç±»å‹å®šä¹‰å±‚ âœ… å·²å®æ–½åˆ†å½¢ç»“æ„
-   [`src/utils/`](src/utils/README.md) - å·¥å…·å‡½æ•°å±‚ âœ… å·²å®æ–½åˆ†å½¢ç»“æ„

#### æŠ€æœ¯æ–‡æ¡£

-   [`docs/architecture-fractal.md`](docs/architecture-fractal.md) - åˆ†å½¢æ¶æ„æ–‡æ¡£ï¼ˆæ–°å¢ï¼‰
-   [`docs/architecture.md`](docs/architecture.md) - åŸæŠ€æœ¯æ¶æ„æ–‡æ¡£ï¼ˆä¿ç•™ï¼‰
-   [`docs/README.md`](docs/README.md) - æ–‡æ¡£ç´¢å¼•

### 4.4 åˆ†å½¢æ–‡æ¡£éªŒè¯

é¡¹ç›®å·²å®æ–½å®Œæ•´çš„åˆ†å½¢æ–‡æ¡£ç»“æ„ï¼ŒåŒ…å«è‡ªåŠ¨éªŒè¯å·¥å…·ï¼š

**è¿è¡ŒéªŒè¯**ï¼š
```bash
node scripts/validate-fractal-docs.cjs
```

**å®‰è£… Git Hooksï¼ˆæäº¤å‰è‡ªåŠ¨éªŒè¯ï¼‰**ï¼š
```bash
bash scripts/install-git-hooks.sh
```

å®‰è£…åï¼Œæ¯æ¬¡ `git commit` å‰ä¼šè‡ªåŠ¨æ£€æŸ¥æ–‡æ¡£å®Œæ•´æ€§ã€‚å¦‚éœ€è·³è¿‡æ£€æŸ¥ï¼Œä½¿ç”¨ `git commit --no-verify`ã€‚

### 4.5 æ‰“åŒ…æ„å»º

æ„å»º macOS åº”ç”¨ï¼ˆéœ€è¦åœ¨ macOS ä¸Šè¿è¡Œï¼‰ï¼š

```bash
# æ™®é€šæ„å»º
npm run build

# ä¼˜åŒ–æ„å»ºï¼ˆæ¨èç”¨äºå‘å¸ƒï¼ŒåŒ…å«é¢å¤–ä¼˜åŒ–ï¼‰
npm run build:optimized

# ä»…æ„å»ºç›®å½•ï¼ˆç”¨äºæµ‹è¯•ï¼Œä¸ç”Ÿæˆå®‰è£…åŒ…ï¼‰
npm run build:dir

# åˆ†ææ„å»ºäº§ç‰©å¤§å°
npm run analyze
```

æ„å»ºè¾“å‡ºä½äº `release/` ç›®å½•ï¼ŒåŒ…å« DMG æ ¼å¼çš„å®‰è£…åŒ…ã€‚

**ä¼˜åŒ–æ„å»ºè¯´æ˜**ï¼š

-   ä½¿ç”¨æœ€å¤§å‹ç¼©çº§åˆ«
-   è‡ªåŠ¨ç§»é™¤ source map
-   æ’é™¤å¼€å‘ä¾èµ–å’Œæµ‹è¯•æ–‡ä»¶
-   æä¾›è¯¦ç»†çš„æ„å»ºåˆ†ææŠ¥å‘Š

è¯¦ç»†çš„ä¼˜åŒ–è¯´æ˜è¯·å‚è€ƒ [æ„å»ºä¼˜åŒ–æŒ‡å—](docs/build-optimization-guide.md)ã€‚

### 4.6 å‘å¸ƒæ›´æ–°

1. æ›´æ–° `package.json` ä¸­çš„ç‰ˆæœ¬å·
2. åœ¨ `package.json` çš„ `build.publish` ä¸­é…ç½® GitHub ä»“åº“ä¿¡æ¯
3. è¿è¡Œ `npm run build` æ„å»ºåº”ç”¨
4. åœ¨ GitHub åˆ›å»ºæ–°çš„ Releaseï¼Œä¸Šä¼ æ„å»ºäº§ç‰©
5. electron-updater ä¼šè‡ªåŠ¨ä» GitHub Releases æ£€æµ‹æ›´æ–°

## 5. æ¥å£è¯´æ˜

**IPC æ¥å£ (Renderer -> Main)**:

### 5.1 æ•°æ®ç›¸å…³

-   `getAnnouncements(page, pageSize)`: åˆ†é¡µè·å–æœ¬åœ°å…¬å‘Šã€‚
-   `syncAnnouncements()`: è§¦å‘åå°åŒæ­¥ã€‚
-   `getNews(src, startDate, endDate)`: è·å–è´¢ç»èµ„è®¯ï¼ˆå®æ—¶ï¼‰ã€‚
-   `getAppVersion()`: è·å–ç‰ˆæœ¬å·ã€‚

### 5.2 è‡ªåŠ¨æ›´æ–°ç›¸å…³

-   `checkForUpdates()`: æ£€æŸ¥æ›´æ–°ã€‚
-   `downloadUpdate()`: ä¸‹è½½æ›´æ–°ã€‚
-   `installUpdate()`: å®‰è£…æ›´æ–°å¹¶é‡å¯ã€‚
-   `onUpdateChecking(callback)`: ç›‘å¬æ£€æŸ¥æ›´æ–°äº‹ä»¶ã€‚
-   `onUpdateAvailable(callback)`: ç›‘å¬å‘ç°æ–°ç‰ˆæœ¬äº‹ä»¶ã€‚
-   `onUpdateNotAvailable(callback)`: ç›‘å¬å·²æ˜¯æœ€æ–°ç‰ˆæœ¬äº‹ä»¶ã€‚
-   `onUpdateDownloadProgress(callback)`: ç›‘å¬ä¸‹è½½è¿›åº¦äº‹ä»¶ã€‚
-   `onUpdateDownloaded(callback)`: ç›‘å¬ä¸‹è½½å®Œæˆäº‹ä»¶ã€‚
-   `onUpdateError(callback)`: ç›‘å¬æ›´æ–°é”™è¯¯äº‹ä»¶ã€‚

## 6. é…ç½®è¯´æ˜

### 6.1 åº”ç”¨ä¿¡æ¯é…ç½®

åœ¨ `package.json` ä¸­é…ç½®ï¼š

```json
{
	"name": "cafe-stock",
	"version": "1.0.0",
	"build": {
		"appId": "com.cafestock.app",
		"productName": "é…·å’–å•¡è‚¡ç¥¨åŠ©æ‰‹"
	}
}
```

### 6.2 è‡ªåŠ¨æ›´æ–°é…ç½®

åœ¨ `package.json` çš„ `build.publish` ä¸­é…ç½® GitHub ä»“åº“ï¼š

```json
{
	"publish": [
		{
			"provider": "github",
			"owner": "your-github-username",
			"repo": "cafe-stock"
		}
	]
}
```
