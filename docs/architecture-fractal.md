# CafeStock 分形架构文档

⚠️ **自指声明**：本文档是系统架构的最高层描述。任何模块架构变更都应同步更新本文档。

---

## 架构哲学

本项目采用分形文档结构，每个层级都包含"依赖、输出和职责"的完整信息：

## 分形文档结构示意

### 文件层注释示例

每个源文件开头包含三行注释：

```typescript
/**
 * 依赖: [依赖的外部模块/API/数据源]
 * 输出: [对外提供的函数/类/接口]
 * 职责: [在系统中的角色定位]
 *
 * ⚠️ 更新提醒：修改此文件后，请同步更新：
 *    1. 本文件开头的 INPUT/OUTPUT/POS 注释
 *    2. 所在目录的 README.md 中的文件列表
 *    3. 如影响架构，更新根目录文档
 */
```

### 目录层 README 示例

每个代码目录包含 README.md：

```markdown
# 模块名称

**架构定位（3 行）**:

-   职责：[模块的核心职责]
-   依赖：[依赖的其他模块]
-   输出：[对外提供的能力]

⚠️ **自指声明**：一旦本文件夹有文件新增/删除/重命名，请立即更新本 README

## 文件清单

[列出所有文件及其功能说明]
```

### 系统层文档示例

根目录和 docs/ 目录的文档描述整体架构和模块关系。

---

## 扩展指南

### 为新模块添加分形结构

1. **为每个文件添加注释头**

    - 使用标准的 依赖/输出/职责 格式
    - 添加更新提醒

2. **创建目录级 README.md**

    - 包含架构定位（3 行）
    - 列出所有文件及功能
    - 添加自指声明
    - 使用 Mermaid 图表说明依赖关系

3. **更新上层文档**

    - 更新根目录 README.md 的模块导航
    - 更新本文档的模块详解章节

4. **运行验证工具**
    - 使用 `node scripts/validate-fractal-docs.cjs` 检查完整性

---

## 维护原则

### 局部影响整体

当你修改一个文件时：

1. 更新文件开头的注释（文件层）
2. 更新所在目录的 README.md（目录层）
3. 如影响架构，更新本文档（系统层）

### 整体影响局部

当架构发生变化时：

1. 更新本文档（系统层）
2. 更新受影响模块的 README.md（目录层）
3. 更新受影响文件的注释（文件层）

### 自指与递归

每个层级都包含"更新我"的提醒，形成自指循环：

-   文件提醒：我变了，更新目录文档
-   目录提醒：我变了，更新系统文档
-   系统提醒：我变了，检查所有模块

---
