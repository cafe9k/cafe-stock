# 开发环境启动说明

## 快速启动

### 一键启动（唯一方式）

```bash
npm run dev
```

**该命令会自动完成所有启动步骤**：
1. 启动 Vite 开发服务器（前端热重载，端口 5173）
2. 监听并自动编译 TypeScript（electron 目录）
3. 自动启动 Electron 应用
4. 监听文件变化，自动重新加载

> **注意**: 无需单独启动 Electron，`npm run dev` 已通过 `vite-plugin-electron` 集成完整启动流程

## 启动流程说明

### 1. Vite 开发服务器
- **端口**: 5173
- **作用**: 提供前端页面的开发和热重载
- **访问**: http://localhost:5173

### 2. Electron 主进程
- **编译**: TypeScript -> JavaScript (dist-electron/)
- **作用**: 应用窗口管理、数据库操作、API 调用

### 3. 自动同步
应用启动时会自动执行：
- 股票列表增量同步（当日新增股票）
- 公告增量同步（当日新公告）

## 开发模式特性

### 自动热重载
- **前端代码** (`src/`): 修改后页面自动刷新，无需重启
- **Electron 主进程** (`electron/main.ts`): 修改后自动重启 Electron
- **预加载脚本** (`electron/preload.ts`): 修改后自动重新加载页面
- **数据库模块** (`electron/db.ts`): 修改后自动重启 Electron

### 调试工具
- **DevTools**: 应用启动时自动打开 Chrome 开发者工具
- **主进程日志**: 在运行 `npm run dev` 的终端查看
- **渲染进程日志**: 在 DevTools Console 面板查看

## 常见问题

### 问题 1: 端口被占用
```bash
# 错误信息
Port 5173 is already in use

# 解决方案
lsof -ti:5173 | xargs kill -9
```

### 问题 2: Electron 进程未关闭
```bash
# 清理所有 Electron 进程
killall -9 Electron

# 或者只清理本项目的进程
pkill -f "Electron.*cafe-stock"
```

### 问题 3: TypeScript 编译错误
```bash
# 清理并重新编译
rm -rf dist-electron
npm run dev
```

### 问题 4: 数据库锁定
```bash
# 关闭所有 Electron 实例
killall -9 Electron

# 删除数据库锁文件（如果存在）
rm -f ~/Library/Application\ Support/cafe-stock/*.db-wal
rm -f ~/Library/Application\ Support/cafe-stock/*.db-shm
```

## 其他启动方式

### 仅启动 Vite（前端开发）
```bash
npm run start
```

### 仅启动 Electron（需要 Vite 已运行）
```bash
npm run electron:dev
```

### 生产环境预览
```bash
npm run electron:preview
```

## 停止应用

### 正常退出
- macOS: `Cmd + Q`
- 或点击窗口关闭按钮

### 强制退出
```bash
# 终止所有 Electron 进程
killall -9 Electron

# 或者在终端按 Ctrl + C
```

## 开发建议

### 1. 修改前端代码
- 直接修改 `src/` 下的文件
- Vite 会自动重载，无需重启

### 2. 修改 Electron 代码
- 修改 `electron/` 下的文件
- 需要重启应用才能生效
- 建议使用 `Cmd + Q` 退出后重新运行 `npm run dev`

### 3. 修改数据库结构
- 修改 `electron/db.ts` 中的表结构
- 需要删除数据库文件重新初始化：
```bash
rm -rf ~/Library/Application\ Support/cafe-stock/*.db
npm run dev
```

### 4. 性能优化
- 使用 Chrome DevTools 的 Performance 面板分析性能
- 使用 Network 面板监控 API 请求

## 环境要求

- **Node.js**: >= 18.0.0
- **npm**: >= 9.0.0
- **macOS**: >= 10.15 (Catalina)

## 相关文件

- `vite.config.ts`: Vite 配置
- `electron/tsconfig.json`: Electron TypeScript 配置
- `package.json`: 启动脚本配置
- `.env`: 环境变量（Tushare API Token）

