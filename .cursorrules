# 项目开发规则

## Supabase 操作规范

### 重要原则
- ✅ **所有 Supabase 操作直接在生产环境运行**
- ✅ **不使用本地 Supabase 环境**
- ✅ **不运行 `supabase start` 命令**
- ✅ **这是演示项目，无需考虑风险**

### 边缘函数部署

#### 直接部署到生产环境

```bash
# 1. 登录 Supabase
supabase login

# 2. 关联生产项目
supabase link --project-ref fmbqlwagajrrktcycnxu

# 3. 配置 Secrets（生产环境）
supabase secrets set TUSHARE_TOKEN=834c0133bb912100b3cdacaeb7b5741523839fd9f8932d9e24c0aa1d

# 4. 直接部署到生产环境
supabase functions deploy tushare-proxy
```

#### 禁止的操作

```bash
# ❌ 不要启动本地 Supabase
supabase start

# ❌ 不要使用本地边缘函数
supabase functions serve tushare-proxy

# ❌ 不要创建本地环境变量文件
# 不需要 supabase/.env 文件
```

### 测试流程

#### 直接测试生产环境

```bash
# 测试生产环境边缘函数
curl -X POST https://fmbqlwagajrrktcycnxu.supabase.co/functions/v1/tushare-proxy \
  -H "Content-Type: application/json" \
  -d '{"api_name": "stock_basic", "params": {"list_status": "L"}}'
```

#### 前端开发

```bash
# 前端直接连接生产环境
npm run dev

# 访问 http://localhost:3000
# 所有 API 请求会自动路由到生产环境的边缘函数
```

### 配置说明

#### Supabase 配置（生产环境）

```typescript
// src/config/supabase.ts
const DEFAULT_SUPABASE_URL = 'https://fmbqlwagajrrktcycnxu.supabase.co'
const DEFAULT_SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'

// 边缘函数 URL（生产环境）
export const SUPABASE_FUNCTIONS_URL = `${SUPABASE_URL}/functions/v1`
```

#### 前端客户端配置

```typescript
// src/lib/tushareClient.ts
// 直接使用生产环境边缘函数
this.apiUrl = `${SUPABASE_FUNCTIONS_URL}/tushare-proxy`
```

### 部署检查清单

#### 首次部署

- [ ] 安装 Supabase CLI
- [ ] 登录 Supabase 账号
- [ ] 关联生产项目
- [ ] 配置生产环境 Secrets
- [ ] 部署边缘函数到生产环境
- [ ] 测试生产环境 API
- [ ] 启动前端开发服务器
- [ ] 验证前端可以正常调用生产环境 API

#### 更新部署

```bash
# 1. 修改边缘函数代码
# 2. 直接部署到生产环境
supabase functions deploy tushare-proxy

# 3. 测试
curl -X POST https://fmbqlwagajrrktcycnxu.supabase.co/functions/v1/tushare-proxy \
  -H "Content-Type: application/json" \
  -d '{"api_name": "stock_basic"}'
```

### 环境变量管理

#### 生产环境 Secrets

```bash
# 查看已配置的 Secrets
supabase secrets list

# 设置 Secret（生产环境）
supabase secrets set TUSHARE_TOKEN=834c0133bb912100b3cdacaeb7b5741523839fd9f8932d9e24c0aa1d

# 更新 Secret（生产环境）
supabase secrets set TUSHARE_TOKEN=new_token_here
```

#### 前端环境变量（可选）

```bash
# .env（如果需要覆盖默认配置）
VITE_SUPABASE_URL=https://fmbqlwagajrrktcycnxu.supabase.co
VITE_SUPABASE_ANON_KEY=your_anon_key_here
```

### 日志查看

```bash
# 查看生产环境边缘函数日志
supabase functions logs tushare-proxy

# 实时查看日志
supabase functions logs tushare-proxy --follow

# 查看最近 100 条日志
supabase functions logs tushare-proxy --limit 100
```

### 故障排查

#### 边缘函数未部署

```bash
# 检查函数列表
supabase functions list

# 重新部署
supabase functions deploy tushare-proxy
```

#### Secrets 未配置

```bash
# 检查 Secrets
supabase secrets list

# 配置 Secrets
supabase secrets set TUSHARE_TOKEN=834c0133bb912100b3cdacaeb7b5741523839fd9f8932d9e24c0aa1d
```

#### API 调用失败

```bash
# 1. 测试边缘函数
curl -X POST https://fmbqlwagajrrktcycnxu.supabase.co/functions/v1/tushare-proxy \
  -H "Content-Type: application/json" \
  -d '{"api_name": "stock_basic"}'

# 2. 查看日志
supabase functions logs tushare-proxy --limit 50

# 3. 检查前端配置
# 确认 src/config/supabase.ts 中的 URL 正确
```

## Node 应用开发规范

- 如果启动端口被占用，则先 kill 被占用端口，然后重新启动

## .md 文档编辑

- 所有 API 出入参数都使用 JSON 格式展示

## JAVA 开发规范

- 遵循阿里巴巴 Java 开发手册
- 类名使用 PascalCase（如 UserService）
- 方法名和变量名使用 camelCase（如 getUserName）
- 使用 4 空格缩进，禁止使用 Tab
- 每行代码长度不超过 120 字符
- Always respond in Chinese-simplified

## 项目特性

- 这是一个演示项目
- 直接使用生产环境进行开发和测试
- 无需考虑数据安全和风险隔离
- 快速迭代，简化流程

